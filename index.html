<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Corferit</title>
<style>
  body { font-family: sans-serif; background: #222; color: #eee; text-align: center; padding: 20px; }
  .btn { margin: 10px; padding: 12px 22px; background: #444; color: #fff; border: none; border-radius: 10px; font-size: 20px; cursor: pointer; }
  #result { margin-top: 20px; font-size: 26px; }
  #history { margin-top: 20px; text-align: left; width: 320px; margin-left: auto; margin-right: auto; max-height: 200px; overflow-y: auto; }
  .esperan√ßa { color: #FFD700; font-weight: bold; }
  .por { color: #800080; font-weight: bold; }
</style>
</head>
<body>
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCLRBsJDKcv9I0hf3uosB0F3w7rXWU-40A",
    authDomain: "corferit-daus.firebaseapp.com",
    projectId: "corferit-daus",
    storageBucket: "corferit-daus.firebasestorage.app",
    messagingSenderId: "756634249064",
    appId: "1:756634249064:web:8e09d8bf75aebcb1b118dd"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
</script>
<script type="module">
// import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

// const firebaseConfig = {
//   apiKey: "TU_API_KEY",
//   projectId: "TU_PROJECT_ID"
// };

// const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const rollsRef = collection(db, "rooms/sala-1/rolls");

async function sendRoll(player, result) {
  await addDoc(rollsRef, {
    player,
    result,
    time: Date.now()
  });
}

onSnapshot(rollsRef, snapshot => {
  snapshot.docChanges().forEach(change => {
    if (change.type === "added") {
      console.log(change.doc.data());
    }
  });
});
</script>

<h1>üé≤ Corferit</h1>

<button class="btn" onclick="rollDuality(0)">D-</button><button class="btn" onclick="rollDuality()">‚¨°‚¨¢</button><button class="btn" onclick="rollDuality(1)">A+</button>

<div id="result"></div>

<h3>Historial</h3>
<div id="history"></div>

<script>
  const history = [];

  function rollD12() {
    return Math.floor(Math.random() * 12) + 1;
  }

  function rollD6() {
    return Math.floor(Math.random() * 6) + 1;
  }

  function rollDuality(v) {
    const esperan√ßa = rollD12();
    const por = rollD12();
    const d6 = rollD6();

    let winner = "";
    let final = 0;
    let colorClass = "";

    if (esperan√ßa >= por) {
      winner = "Esperan√ßa (Hope)";
      colorClass = "esperan√ßa";
    } else {
      winner = "Por (Fear)";
      colorClass = "por";
    }

    final = esperan√ßa + por;

    const text = `
      <div>
        ‚¨° ${esperan√ßa} | ‚¨¢ ${por}<br>
        <strong>${final}</strong> amb <span class="${colorClass}">${winner}</span>.
      </div>
    `;

    if (v == 1) {
      final += d6;
          const text = `
            <div>
              ‚¨° ${esperan√ßa} | ‚¨¢ ${por} | +‚öÖ ${d6} <br>
              <strong>${final}</strong> amb <span class="${colorClass}">${winner}</span>.
            </div>
          `;
    } else if (v == 0) {
      final -= d6;
          const text = `
            <div>
              ‚¨° ${esperan√ßa} | ‚¨¢ ${por} | -‚öÖ ${d6} <br>
              <strong>${final}</strong> amb <span class="${colorClass}">${winner}</span>.
            </div>
          `;
    }

    document.getElementById("result").innerHTML = text;

    history.unshift(text);
    if (history.length > 20) history.pop(); // limita el hist√≥rico
    document.getElementById("history").innerHTML = history.join("<hr>");
  }
</script>

</body>
</html>
